<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Analyze Page V4 - Interactive AI Chat with Streaming</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'bg-dark': '#0a0a0f',
            'surface-dark': '#12121a',
            'primary': '#6366f1',
            'text-secondary-dark': '#71717a',
          }
        }
      }
    }
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');
    body { font-family: 'Inter', sans-serif; }
    .mono { font-family: 'JetBrains Mono', monospace; }

    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: #12121a; }
    ::-webkit-scrollbar-thumb { background: #27272a; border-radius: 3px; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }

    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .animate-slide-up { animation: slideUp 0.4s ease-out forwards; }

    @keyframes typing { 0%, 60%, 100% { opacity: 0.3; } 30% { opacity: 1; } }
    .typing-dot:nth-child(1) { animation: typing 1.4s infinite 0s; }
    .typing-dot:nth-child(2) { animation: typing 1.4s infinite 0.2s; }
    .typing-dot:nth-child(3) { animation: typing 1.4s infinite 0.4s; }

    @keyframes pulse-border { 0%, 100% { border-color: rgba(99, 102, 241, 0.3); } 50% { border-color: rgba(99, 102, 241, 0.8); } }
    .pulse-border { animation: pulse-border 2s ease-in-out infinite; }

    @keyframes stream-line { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
    .stream-line { animation: stream-line 0.2s ease-out forwards; }

    @keyframes blink { 0%, 50% { opacity: 1; } 51%, 100% { opacity: 0; } }
    .cursor-blink::after { content: '|'; animation: blink 1s infinite; color: #6366f1; }

    .tree-item:hover { background: rgba(255,255,255,0.03); }
    .tree-item.selected { background: rgba(99, 102, 241, 0.1); }

    .custom-checkbox {
      appearance: none; width: 16px; height: 16px;
      border: 1px solid rgba(255,255,255,0.2); border-radius: 4px;
      background: transparent; cursor: pointer; position: relative;
    }
    .custom-checkbox:checked { background: #6366f1; border-color: #6366f1; }
    .custom-checkbox:checked::after {
      content: ''; position: absolute; left: 5px; top: 2px;
      width: 4px; height: 8px; border: solid white;
      border-width: 0 2px 2px 0; transform: rotate(45deg);
    }

    .step-indicator { transition: all 0.3s ease; }
    .step-indicator.active { background: linear-gradient(135deg, #6366f1, #06b6d4); }
    .step-indicator.completed { background: #22c55e; }

    .log-line { font-size: 11px; line-height: 1.6; }
    .log-line.info { color: #71717a; }
    .log-line.success { color: #22c55e; }
    .log-line.warning { color: #f59e0b; }
    .log-line.error { color: #ef4444; }
    .log-line.highlight { color: #6366f1; }
  </style>
</head>
<body class="bg-bg-dark min-h-screen text-white">

  <!-- Sidebar -->
  <aside class="fixed left-0 top-0 bottom-0 w-16 bg-surface-dark border-r border-white/10 flex flex-col items-center py-4 z-50">
    <div class="w-10 h-10 bg-gradient-to-br from-primary to-cyan-500 rounded-xl flex items-center justify-center mb-8">
      <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
    </div>
    <nav class="flex flex-col gap-2">
      <button class="p-3 rounded-xl text-text-secondary-dark hover:text-white hover:bg-white/5"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg></button>
      <button class="p-3 rounded-xl bg-primary/10 text-primary"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg></button>
      <button class="p-3 rounded-xl text-text-secondary-dark hover:text-white hover:bg-white/5"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/></svg></button>
      <button class="p-3 rounded-xl text-text-secondary-dark hover:text-white hover:bg-white/5"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg></button>
    </nav>
    <div class="mt-auto">
      <button onclick="toggleSettingsModal()" class="p-3 rounded-xl text-text-secondary-dark hover:text-white hover:bg-white/5"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg></button>
    </div>
  </aside>

  <main class="ml-16 h-screen flex flex-col">
    <!-- Header -->
    <header class="flex-shrink-0 border-b border-white/10 bg-surface-dark/80 backdrop-blur-xl">
      <div class="px-6 py-3">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-4">
            <div class="w-9 h-9 bg-gradient-to-br from-primary to-cyan-500 rounded-xl flex items-center justify-center">
              <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
            </div>
            <div>
              <h1 class="text-base font-bold text-white">Code Analysis</h1>
              <p class="text-[10px] text-text-secondary-dark">AI-powered QA generation</p>
            </div>

            <!-- Step Progress in Header -->
            <div class="flex items-center gap-2 ml-6 pl-6 border-l border-white/10">
              <div class="step-indicator active w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-bold text-white">1</div>
              <span class="text-xs text-white">Select</span>
              <svg class="w-4 h-4 text-white/20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
              <div class="step-indicator w-6 h-6 rounded-full bg-white/10 flex items-center justify-center text-[10px] font-bold text-text-secondary-dark">2</div>
              <span class="text-xs text-text-secondary-dark">Configure</span>
              <svg class="w-4 h-4 text-white/20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
              <div class="step-indicator w-6 h-6 rounded-full bg-white/10 flex items-center justify-center text-[10px] font-bold text-text-secondary-dark">3</div>
              <span class="text-xs text-text-secondary-dark">Generate</span>
            </div>
          </div>

          <div class="flex items-center gap-2">
            <div class="flex items-center gap-1.5 px-2 py-1 bg-green-500/10 border border-green-500/20 rounded">
              <svg class="w-3 h-3 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
              <span class="text-[10px] text-green-400">Local</span>
            </div>
            <button class="px-2.5 py-1.5 text-xs text-text-secondary-dark hover:text-white hover:bg-white/5 rounded">History</button>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Split View -->
    <div class="flex-1 flex overflow-hidden">

      <!-- LEFT: Source Selection (Compact) -->
      <div class="w-[50%] border-r border-white/10 flex flex-col">
        <!-- Source Tabs -->
        <div class="flex items-center gap-1 p-2 border-b border-white/10 bg-surface-dark/50">
          <button class="flex items-center gap-1.5 px-3 py-2 rounded text-xs font-medium bg-primary/10 text-primary border border-primary/30">
            <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
            GitHub
          </button>
          <button class="flex items-center gap-1.5 px-3 py-2 rounded text-xs font-medium text-text-secondary-dark hover:text-white hover:bg-white/5">
            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
            Paste
          </button>
          <button class="flex items-center gap-1.5 px-3 py-2 rounded text-xs font-medium text-text-secondary-dark hover:text-white hover:bg-white/5">
            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
            Upload
          </button>
          <div class="flex-1"></div>
          <span class="text-[10px] text-text-secondary-dark">3 cached</span>
        </div>

        <!-- Repo + Files Grid -->
        <div class="flex-1 flex overflow-hidden">
          <!-- Repos -->
          <div class="w-1/2 border-r border-white/10 flex flex-col">
            <div class="p-2 border-b border-white/10">
              <input type="text" placeholder="Search..." class="w-full px-3 py-1.5 bg-bg-dark border border-white/10 rounded text-xs text-white placeholder-text-secondary-dark focus:outline-none focus:border-primary/50">
            </div>
            <div class="flex-1 overflow-y-auto p-1.5 space-y-1">
              <div class="flex items-center gap-2 p-2 bg-primary/10 border border-primary/30 rounded cursor-pointer">
                <svg class="w-4 h-4 text-text-secondary-dark" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                <div class="flex-1 min-w-0">
                  <span class="text-xs font-medium text-white truncate block">OrizonQA</span>
                  <span class="text-[10px] text-text-secondary-dark">QA platform</span>
                </div>
              </div>
              <div class="flex items-center gap-2 p-2 hover:bg-white/5 rounded cursor-pointer">
                <svg class="w-4 h-4 text-text-secondary-dark" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                <span class="text-xs text-white truncate">react-dashboard</span>
              </div>
              <div class="flex items-center gap-2 p-2 hover:bg-white/5 rounded cursor-pointer">
                <svg class="w-4 h-4 text-text-secondary-dark" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                <span class="text-xs text-white truncate">api-gateway</span>
              </div>
            </div>
            <div class="p-2 border-t border-white/10 flex items-center gap-2">
              <span class="text-[10px] text-text-secondary-dark">Branch:</span>
              <button class="flex items-center gap-1 px-2 py-0.5 bg-bg-dark border border-white/10 rounded text-[10px] text-white">
                main <svg class="w-2.5 h-2.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
              </button>
            </div>
          </div>

          <!-- Files -->
          <div class="w-1/2 flex flex-col">
            <div class="p-2 border-b border-white/10 flex items-center justify-between">
              <span class="text-xs font-medium text-white">Files</span>
              <span class="text-[10px] text-primary">12 selected</span>
            </div>
            <div class="p-1.5 border-b border-white/10 flex flex-wrap gap-1">
              <button class="px-2 py-0.5 text-[10px] bg-blue-500/20 text-blue-400 border border-blue-500/30 rounded">API</button>
              <button class="px-2 py-0.5 text-[10px] bg-white/5 text-text-secondary-dark border border-white/10 rounded">Components</button>
              <button class="px-2 py-0.5 text-[10px] bg-white/5 text-text-secondary-dark border border-white/10 rounded">Hooks</button>
            </div>
            <div class="flex-1 overflow-y-auto p-1.5">
              <div class="tree-item selected flex items-center gap-1.5 px-2 py-1 rounded">
                <svg class="w-3 h-3 text-text-secondary-dark rotate-90" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                <input type="checkbox" checked class="custom-checkbox" style="width:12px;height:12px;">
                <svg class="w-3.5 h-3.5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/></svg>
                <span class="text-[11px] text-white">app/api</span>
                <span class="text-[10px] text-primary ml-auto">12</span>
              </div>
              <div class="tree-item selected flex items-center gap-1.5 px-2 py-0.5 pl-6 rounded">
                <input type="checkbox" checked class="custom-checkbox" style="width:12px;height:12px;">
                <svg class="w-3 h-3 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                <span class="text-[10px] text-white">analyze/route.js</span>
              </div>
              <div class="tree-item selected flex items-center gap-1.5 px-2 py-0.5 pl-6 rounded">
                <input type="checkbox" checked class="custom-checkbox" style="width:12px;height:12px;">
                <svg class="w-3 h-3 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                <span class="text-[10px] text-white">execute/route.js</span>
              </div>
              <div class="tree-item selected flex items-center gap-1.5 px-2 py-0.5 pl-6 rounded">
                <input type="checkbox" checked class="custom-checkbox" style="width:12px;height:12px;">
                <svg class="w-3 h-3 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                <span class="text-[10px] text-white">projects/route.js</span>
              </div>
              <div class="tree-item flex items-center gap-1.5 px-2 py-1 rounded hover:bg-white/5">
                <svg class="w-3 h-3 text-text-secondary-dark" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                <input type="checkbox" class="custom-checkbox" style="width:12px;height:12px;">
                <svg class="w-3.5 h-3.5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/></svg>
                <span class="text-[11px] text-white">components</span>
                <span class="text-[10px] text-text-secondary-dark ml-auto">28</span>
              </div>
            </div>
            <div class="p-2 border-t border-white/10 flex items-center justify-between text-[10px]">
              <span class="text-white">~15K tokens</span>
              <span class="text-primary font-medium">$0.05</span>
            </div>
          </div>
        </div>
      </div>

      <!-- RIGHT: AI Chat with Streaming -->
      <div class="w-[50%] flex flex-col bg-surface-dark/30">

        <!-- Chat Header with View Toggle -->
        <div class="flex-shrink-0 px-4 py-2.5 border-b border-white/10 flex items-center gap-3">
          <div class="w-7 h-7 rounded-lg bg-gradient-to-br from-primary to-cyan-500 flex items-center justify-center">
            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
          </div>
          <div class="flex-1">
            <h3 class="text-sm font-medium text-white">ORIZON Assistant</h3>
            <p class="text-[10px] text-green-400">Connected • Claude Sonnet 4</p>
          </div>

          <!-- View Mode Toggle -->
          <div class="flex items-center bg-bg-dark rounded-lg p-0.5">
            <button onclick="setViewMode('simple')" id="btn-simple" class="px-3 py-1 text-[10px] font-medium rounded bg-primary text-white">Simple</button>
            <button onclick="setViewMode('detailed')" id="btn-detailed" class="px-3 py-1 text-[10px] font-medium rounded text-text-secondary-dark hover:text-white">Detailed</button>
          </div>
        </div>

        <!-- Chat Messages with Streaming -->
        <div class="flex-1 overflow-y-auto p-4 space-y-4" id="chatMessages">

          <!-- Welcome + Guide -->
          <div class="chat-message flex gap-3 animate-fade-in">
            <div class="w-6 h-6 rounded-lg bg-gradient-to-br from-primary to-cyan-500 flex items-center justify-center flex-shrink-0">
              <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
            </div>
            <div class="flex-1 space-y-3">
              <div class="bg-bg-dark rounded-xl rounded-tl-sm p-3">
                <p class="text-sm text-white leading-relaxed">
                  Welcome! I've detected <span class="text-primary font-medium">OrizonQA</span> with <span class="text-primary font-medium">12 API files</span> selected.
                </p>
                <p class="text-sm text-white leading-relaxed mt-2">Let me guide you through generating tests:</p>
              </div>

              <!-- Step Guide Cards -->
              <div class="space-y-2">
                <div class="flex items-center gap-3 p-2.5 bg-primary/10 border border-primary/30 rounded-lg pulse-border">
                  <div class="w-6 h-6 rounded-full bg-primary flex items-center justify-center text-[10px] font-bold text-white">1</div>
                  <div class="flex-1">
                    <p class="text-xs font-medium text-white">Select source & files</p>
                    <p class="text-[10px] text-text-secondary-dark">Choose what code to analyze</p>
                  </div>
                  <span class="text-[10px] text-primary">Current</span>
                </div>
                <div class="flex items-center gap-3 p-2.5 bg-white/5 border border-white/10 rounded-lg">
                  <div class="w-6 h-6 rounded-full bg-white/10 flex items-center justify-center text-[10px] font-bold text-text-secondary-dark">2</div>
                  <div class="flex-1">
                    <p class="text-xs font-medium text-white">Choose what to generate</p>
                    <p class="text-[10px] text-text-secondary-dark">Tests, stories, or criteria</p>
                  </div>
                </div>
                <div class="flex items-center gap-3 p-2.5 bg-white/5 border border-white/10 rounded-lg">
                  <div class="w-6 h-6 rounded-full bg-white/10 flex items-center justify-center text-[10px] font-bold text-text-secondary-dark">3</div>
                  <div class="flex-1">
                    <p class="text-xs font-medium text-white">Generate & execute</p>
                    <p class="text-[10px] text-text-secondary-dark">AI generates, you can run tests</p>
                  </div>
                </div>
              </div>

              <p class="text-xs text-text-secondary-dark">What would you like to generate?</p>

              <!-- Quick Actions -->
              <div class="flex flex-wrap gap-2">
                <button onclick="selectAction('api-tests')" class="px-3 py-2 bg-blue-500/10 border border-blue-500/20 rounded-lg text-xs text-blue-400 hover:bg-blue-500/20 transition-all flex items-center gap-1.5">
                  <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                  API Tests
                </button>
                <button onclick="selectAction('user-stories')" class="px-3 py-2 bg-purple-500/10 border border-purple-500/20 rounded-lg text-xs text-purple-400 hover:bg-purple-500/20 transition-all flex items-center gap-1.5">
                  <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg>
                  User Stories
                </button>
                <button onclick="selectAction('full-suite')" class="px-3 py-2 bg-amber-500/10 border border-amber-500/20 rounded-lg text-xs text-amber-400 hover:bg-amber-500/20 transition-all flex items-center gap-1.5">
                  <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
                  Full QA Suite
                </button>
              </div>
            </div>
          </div>

          <!-- User Selection -->
          <div class="chat-message flex gap-3 justify-end" id="userMessage1" style="display:none;">
            <div class="bg-primary/20 rounded-xl rounded-tr-sm p-3 max-w-[80%]">
              <p class="text-sm text-white">Generate API Tests</p>
            </div>
            <div class="w-6 h-6 rounded-lg bg-white/10 flex items-center justify-center flex-shrink-0">
              <span class="text-[10px] font-medium text-white">U</span>
            </div>
          </div>

          <!-- AI Analysis with Streaming Output -->
          <div class="chat-message flex gap-3" id="analysisMessage" style="display:none;">
            <div class="w-6 h-6 rounded-lg bg-gradient-to-br from-primary to-cyan-500 flex items-center justify-center flex-shrink-0">
              <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
            </div>
            <div class="flex-1 space-y-3">
              <!-- Code Analysis Summary -->
              <div class="bg-bg-dark rounded-xl rounded-tl-sm p-3 space-y-3">
                <div class="flex items-center justify-between">
                  <span class="text-xs font-medium text-white">Analyzing your code...</span>
                  <span class="text-[10px] text-green-400" id="analysisStatus">Complete</span>
                </div>

                <!-- Simple View: Summary Stats -->
                <div id="simpleView" class="grid grid-cols-4 gap-2">
                  <div class="p-2 bg-white/5 rounded text-center">
                    <div class="text-lg font-bold text-white">12</div>
                    <div class="text-[10px] text-text-secondary-dark">Endpoints</div>
                  </div>
                  <div class="p-2 bg-white/5 rounded text-center">
                    <div class="text-lg font-bold text-white">4</div>
                    <div class="text-[10px] text-text-secondary-dark">Auth</div>
                  </div>
                  <div class="p-2 bg-white/5 rounded text-center">
                    <div class="text-lg font-bold text-white">8</div>
                    <div class="text-[10px] text-text-secondary-dark">CRUD</div>
                  </div>
                  <div class="p-2 bg-white/5 rounded text-center">
                    <div class="text-lg font-bold text-white">36</div>
                    <div class="text-[10px] text-text-secondary-dark">Tests</div>
                  </div>
                </div>

                <!-- Detailed View: Streaming Logs -->
                <div id="detailedView" class="hidden">
                  <div class="bg-black/30 rounded-lg p-3 max-h-40 overflow-y-auto mono" id="streamingLogs">
                    <div class="log-line info stream-line">[00:00.0] Starting code analysis...</div>
                    <div class="log-line success stream-line">[00:00.2] Connected to Claude Sonnet 4</div>
                    <div class="log-line info stream-line">[00:00.3] Loading files from OrizonQA/app/api...</div>
                    <div class="log-line highlight stream-line">[00:00.5] Analyzing: analyze/route.js (4.1KB)</div>
                    <div class="log-line info stream-line">[00:01.2]   Found: POST /api/analyze</div>
                    <div class="log-line info stream-line">[00:01.3]   Found: Authentication required</div>
                    <div class="log-line info stream-line">[00:01.4]   Found: Request body validation</div>
                    <div class="log-line highlight stream-line">[00:01.8] Analyzing: execute-tests/route.js (3.8KB)</div>
                    <div class="log-line info stream-line">[00:02.4]   Found: POST /api/execute-tests</div>
                    <div class="log-line info stream-line">[00:02.5]   Found: GET /api/execute-tests/:id</div>
                    <div class="log-line info stream-line">[00:02.6]   Found: WebContainer integration</div>
                    <div class="log-line highlight stream-line">[00:03.0] Analyzing: projects/route.js (2.9KB)</div>
                    <div class="log-line success stream-line">[00:04.2] Analysis complete: 12 endpoints found</div>
                    <div class="log-line success stream-line">[00:04.3] Generating 36 test cases...</div>
                  </div>
                </div>
              </div>

              <!-- Test Generation Preview -->
              <div class="bg-bg-dark rounded-xl p-3 space-y-2">
                <div class="flex items-center justify-between">
                  <span class="text-xs font-medium text-white">Tests to Generate</span>
                  <span class="text-[10px] text-text-secondary-dark">Jest + Supertest</span>
                </div>
                <div class="space-y-1.5">
                  <div class="flex items-center gap-2 text-xs">
                    <svg class="w-3 h-3 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                    <span class="text-white">12 success scenarios (200, 201)</span>
                  </div>
                  <div class="flex items-center gap-2 text-xs">
                    <svg class="w-3 h-3 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                    <span class="text-white">16 error handlers (400, 401, 404, 500)</span>
                  </div>
                  <div class="flex items-center gap-2 text-xs">
                    <svg class="w-3 h-3 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                    <span class="text-white">8 edge cases</span>
                  </div>
                </div>
              </div>

              <!-- Ready to Generate -->
              <div class="bg-gradient-to-r from-primary/20 to-cyan-500/20 border border-primary/30 rounded-xl p-4">
                <div class="flex items-center gap-3 mb-3">
                  <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-primary to-cyan-500 flex items-center justify-center">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                  </div>
                  <div class="flex-1">
                    <h4 class="text-sm font-semibold text-white">Ready to Generate</h4>
                    <p class="text-[10px] text-text-secondary-dark">36 tests • ~15K tokens • $0.05</p>
                  </div>
                </div>

                <button onclick="startGeneration()" class="w-full py-3 bg-gradient-to-r from-primary to-cyan-500 text-white font-semibold rounded-xl hover:shadow-lg hover:shadow-primary/25 transition-all flex items-center justify-center gap-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                  Generate Tests
                </button>

                <div class="flex items-center justify-center gap-4 mt-3">
                  <button class="text-[10px] text-text-secondary-dark hover:text-white">+ Add security tests</button>
                  <span class="text-white/20">|</span>
                  <button class="text-[10px] text-text-secondary-dark hover:text-white">Change format</button>
                  <span class="text-white/20">|</span>
                  <button class="text-[10px] text-text-secondary-dark hover:text-white">Edit config</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Generation Streaming -->
          <div class="chat-message flex gap-3" id="generationMessage" style="display:none;">
            <div class="w-6 h-6 rounded-lg bg-gradient-to-br from-primary to-cyan-500 flex items-center justify-center flex-shrink-0">
              <svg class="w-3 h-3 text-white animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
            </div>
            <div class="flex-1 space-y-3">
              <!-- Progress Header -->
              <div class="bg-bg-dark rounded-xl rounded-tl-sm p-3">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-xs font-medium text-white">Generating tests...</span>
                  <span class="text-xs text-primary" id="genProgress">18/36</span>
                </div>
                <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                  <div class="h-full bg-gradient-to-r from-primary to-cyan-500 rounded-full transition-all duration-300" style="width: 50%" id="genProgressBar"></div>
                </div>
                <div class="flex items-center justify-between mt-2 text-[10px] text-text-secondary-dark">
                  <span>Elapsed: 00:23</span>
                  <span>~8,500 tokens used</span>
                  <span>ETA: ~00:20</span>
                </div>
              </div>

              <!-- Simple View: Current Stage -->
              <div id="genSimpleView" class="space-y-2">
                <div class="flex items-center gap-2 p-2 bg-green-500/10 rounded-lg">
                  <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                  <span class="text-xs text-white">Analyzing code structure</span>
                  <span class="text-[10px] text-green-400 ml-auto">Done</span>
                </div>
                <div class="flex items-center gap-2 p-2 bg-primary/10 rounded-lg">
                  <svg class="w-4 h-4 text-primary animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
                  <span class="text-xs text-white">Generating test cases...</span>
                  <span class="text-[10px] text-primary ml-auto">18/36</span>
                </div>
                <div class="flex items-center gap-2 p-2 bg-white/5 rounded-lg">
                  <div class="w-4 h-4 rounded-full border border-white/20"></div>
                  <span class="text-xs text-text-secondary-dark">Formatting output</span>
                </div>
              </div>

              <!-- Detailed View: Live Streaming -->
              <div id="genDetailedView" class="hidden">
                <div class="bg-black/30 rounded-lg p-3 max-h-60 overflow-y-auto mono" id="genStreamingLogs">
                  <div class="log-line success">[00:00.0] Starting test generation...</div>
                  <div class="log-line info">[00:00.1] Target: 36 test cases</div>
                  <div class="log-line highlight">[00:00.5] Generating tests for: POST /api/analyze</div>
                  <div class="log-line info">[00:01.2]   + should return 200 with valid request</div>
                  <div class="log-line info">[00:01.8]   + should return 401 without auth</div>
                  <div class="log-line info">[00:02.3]   + should return 400 with invalid body</div>
                  <div class="log-line highlight">[00:03.0] Generating tests for: POST /api/execute-tests</div>
                  <div class="log-line info">[00:03.8]   + should create execution record</div>
                  <div class="log-line info">[00:04.5]   + should stream progress via SSE</div>
                  <div class="log-line info">[00:05.2]   + should handle cancellation</div>
                  <div class="log-line highlight">[00:06.0] Generating tests for: GET /api/execute-tests/:id</div>
                  <div class="log-line info">[00:06.8]   + should return execution details</div>
                  <div class="log-line info">[00:07.4]   + should return 404 for unknown id</div>
                </div>

                <!-- Live Code Preview -->
                <div class="mt-2 bg-black/30 rounded-lg p-3">
                  <div class="flex items-center justify-between mb-2">
                    <span class="text-[10px] text-text-secondary-dark">Live Preview</span>
                    <span class="text-[10px] text-primary">analyze.test.js</span>
                  </div>
                  <pre class="text-[10px] text-green-400 overflow-x-auto"><code id="liveCode">describe('POST /api/analyze', () => {
  it('should return 200 with valid request', async () => {
    const response = await request(app)
      .post('/api/analyze')
      .set('Authorization', 'Bearer token')
      .send({ code: 'function test() {}' });

    expect(response.status).toBe(200);
    expect(response.body).toHaveProperty('result');
  });<span class="cursor-blink"></span></code></pre>
                </div>
              </div>

              <!-- Cancel Button -->
              <button class="w-full py-2 bg-white/5 hover:bg-white/10 text-text-secondary-dark hover:text-white text-xs rounded-lg transition-colors">
                Cancel Generation
              </button>
            </div>
          </div>

          <!-- Completion Message -->
          <div class="chat-message flex gap-3" id="completionMessage" style="display:none;">
            <div class="w-6 h-6 rounded-lg bg-green-500 flex items-center justify-center flex-shrink-0">
              <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
            </div>
            <div class="flex-1 space-y-3">
              <div class="bg-green-500/10 border border-green-500/20 rounded-xl p-4">
                <div class="flex items-center gap-3 mb-3">
                  <div>
                    <h4 class="text-sm font-semibold text-white">Generation Complete!</h4>
                    <p class="text-[10px] text-text-secondary-dark">36 tests generated in 45 seconds</p>
                  </div>
                  <div class="ml-auto flex items-center gap-2">
                    <span class="px-2 py-0.5 bg-green-500/20 text-green-400 text-[10px] rounded-full">Jest</span>
                    <span class="px-2 py-0.5 bg-green-500/20 text-green-400 text-[10px] rounded-full">Executable</span>
                  </div>
                </div>

                <div class="grid grid-cols-3 gap-2 mb-4">
                  <div class="p-2 bg-white/5 rounded text-center">
                    <div class="text-lg font-bold text-white">36</div>
                    <div class="text-[10px] text-text-secondary-dark">Tests</div>
                  </div>
                  <div class="p-2 bg-white/5 rounded text-center">
                    <div class="text-lg font-bold text-white">15,234</div>
                    <div class="text-[10px] text-text-secondary-dark">Tokens</div>
                  </div>
                  <div class="p-2 bg-white/5 rounded text-center">
                    <div class="text-lg font-bold text-primary">$0.05</div>
                    <div class="text-[10px] text-text-secondary-dark">Cost</div>
                  </div>
                </div>

                <div class="flex gap-2">
                  <button class="flex-1 py-2.5 bg-primary hover:bg-primary/90 text-white text-xs font-medium rounded-lg flex items-center justify-center gap-1.5">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    Execute Tests
                  </button>
                  <button class="px-4 py-2.5 bg-white/5 hover:bg-white/10 text-white text-xs font-medium rounded-lg flex items-center justify-center gap-1.5">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
                    Copy
                  </button>
                  <button class="px-4 py-2.5 bg-white/5 hover:bg-white/10 text-white text-xs font-medium rounded-lg flex items-center justify-center gap-1.5">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                    Download
                  </button>
                </div>
              </div>

              <!-- What's Next -->
              <div class="bg-bg-dark rounded-xl p-3">
                <p class="text-xs text-text-secondary-dark mb-2">What would you like to do next?</p>
                <div class="flex flex-wrap gap-2">
                  <button class="px-3 py-1.5 bg-white/5 border border-white/10 rounded text-[10px] text-text-secondary-dark hover:text-white hover:bg-white/10">Generate user stories</button>
                  <button class="px-3 py-1.5 bg-white/5 border border-white/10 rounded text-[10px] text-text-secondary-dark hover:text-white hover:bg-white/10">Add more files</button>
                  <button class="px-3 py-1.5 bg-white/5 border border-white/10 rounded text-[10px] text-text-secondary-dark hover:text-white hover:bg-white/10">Save to project</button>
                  <button class="px-3 py-1.5 bg-white/5 border border-white/10 rounded text-[10px] text-text-secondary-dark hover:text-white hover:bg-white/10">Start new analysis</button>
                </div>
              </div>
            </div>
          </div>

        </div>

        <!-- Chat Input -->
        <div class="flex-shrink-0 p-3 border-t border-white/10">
          <div class="relative">
            <textarea
              placeholder="Ask me anything or type a command..."
              class="w-full px-3 py-2.5 pr-10 bg-bg-dark border border-white/10 rounded-lg text-sm text-white placeholder-text-secondary-dark resize-none focus:outline-none focus:border-primary/50"
              rows="1"
              id="chatInput"
            ></textarea>
            <button class="absolute right-2 top-1/2 -translate-y-1/2 p-1.5 bg-primary hover:bg-primary/80 rounded transition-colors">
              <svg class="w-3.5 h-3.5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>
            </button>
          </div>
          <div class="flex items-center justify-between mt-1.5 text-[10px] text-text-secondary-dark">
            <span>Claude Sonnet 4</span>
            <div class="flex items-center gap-2">
              <kbd class="px-1 py-0.5 bg-white/5 rounded">Cmd+Enter</kbd>
              <span>to generate</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Settings Modal (unchanged) -->
  <div id="settingsModal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-6">
    <div class="bg-surface-dark border border-white/10 rounded-2xl w-full max-w-2xl">
      <div class="px-6 py-4 border-b border-white/10 flex items-center justify-between">
        <h3 class="text-lg font-semibold text-white">Settings</h3>
        <button onclick="toggleSettingsModal()" class="p-1.5 hover:bg-white/5 rounded-lg">
          <svg class="w-5 h-5 text-text-secondary-dark" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="p-6">
        <p class="text-sm text-text-secondary-dark">AI Provider, Output Format, Test Framework, and other settings would go here.</p>
      </div>
      <div class="px-6 py-4 border-t border-white/10 flex justify-end gap-3">
        <button onclick="toggleSettingsModal()" class="px-4 py-2 text-sm text-text-secondary-dark hover:text-white">Cancel</button>
        <button onclick="toggleSettingsModal()" class="px-4 py-2 bg-primary hover:bg-primary/90 text-white text-sm font-medium rounded-lg">Save</button>
      </div>
    </div>
  </div>

  <script>
    let viewMode = 'simple';

    function setViewMode(mode) {
      viewMode = mode;
      document.getElementById('btn-simple').className = mode === 'simple'
        ? 'px-3 py-1 text-[10px] font-medium rounded bg-primary text-white'
        : 'px-3 py-1 text-[10px] font-medium rounded text-text-secondary-dark hover:text-white';
      document.getElementById('btn-detailed').className = mode === 'detailed'
        ? 'px-3 py-1 text-[10px] font-medium rounded bg-primary text-white'
        : 'px-3 py-1 text-[10px] font-medium rounded text-text-secondary-dark hover:text-white';

      // Toggle views
      document.getElementById('simpleView').classList.toggle('hidden', mode === 'detailed');
      document.getElementById('detailedView').classList.toggle('hidden', mode === 'simple');
      document.getElementById('genSimpleView')?.classList.toggle('hidden', mode === 'detailed');
      document.getElementById('genDetailedView')?.classList.toggle('hidden', mode === 'simple');
    }

    function toggleSettingsModal() {
      document.getElementById('settingsModal').classList.toggle('hidden');
    }

    function selectAction(action) {
      // Show user message
      document.getElementById('userMessage1').style.display = 'flex';
      // Show analysis message
      setTimeout(() => {
        document.getElementById('analysisMessage').style.display = 'flex';
        document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
      }, 500);
    }

    function startGeneration() {
      // Hide analysis, show generation
      document.getElementById('analysisMessage').style.display = 'none';
      document.getElementById('generationMessage').style.display = 'flex';

      // Simulate progress
      let progress = 0;
      const interval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress >= 100) {
          progress = 100;
          clearInterval(interval);
          setTimeout(() => {
            document.getElementById('generationMessage').style.display = 'none';
            document.getElementById('completionMessage').style.display = 'flex';
            document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
          }, 500);
        }
        document.getElementById('genProgressBar').style.width = `${progress}%`;
        document.getElementById('genProgress').textContent = `${Math.round(progress * 0.36)}/36`;
      }, 800);
    }
  </script>

</body>
</html>
